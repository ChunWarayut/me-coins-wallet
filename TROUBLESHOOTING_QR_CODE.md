# üîß ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• QR Code

## ‚ùå ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API `/payments/intents` ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ error:
```
‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• QR Code
```

---

## üîç ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏

‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å 3 ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏´‡∏•‡∏±‡∏Å:

### 1. ‡πÉ‡∏ä‡πâ Test Mode (‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î) ‚ö†Ô∏è

Stripe **Test Mode** (`sk_test_...`) **‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö PromptPay ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö**

PromptPay ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ ‡πÅ‡∏•‡∏∞ Stripe ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô **Live Mode** ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

### 2. ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Stripe ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PromptPay

‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Stripe ‡∏ï‡πâ‡∏≠‡∏á:
- ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢
- ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô PromptPay payment method
- ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Stripe

### 3. API Version ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô

‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á Stripe API version ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô property name ‡∏Ç‡∏≠‡∏á QR Code response

---

## ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Live Mode (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

#### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:

1. **‡πÄ‡∏Ç‡πâ‡∏≤ Stripe Dashboard**
   - ‡πÑ‡∏õ‡∏ó‡∏µ‡πà: https://dashboard.stripe.com/apikeys
   - ‡∏™‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å "Test mode" ‡πÄ‡∏õ‡πá‡∏ô "Live mode" (toggle ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)

2. **‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Live Secret Key**
   ```
   sk_live_YOUR_LIVE_SECRET_KEY_HERE
   ```

3. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç .env**
   ```env
   # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å Test Key
   # STRIPE_SECRET_KEY=sk_test_YOUR_TEST_KEY_HERE
   
   # ‡πÄ‡∏õ‡πá‡∏ô Live Key
   STRIPE_SECRET_KEY=sk_live_YOUR_LIVE_SECRET_KEY_HERE
   ```

4. **‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Live Webhook**
   ```bash
   # ‡πÉ‡∏ä‡πâ --forward-to ‡∏Å‡∏±‡∏ö live mode
   stripe listen --forward-to localhost:3000/payments/webhook --live
   ```

5. **Restart ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå**
   ```bash
   npm run start:dev
   ```

6. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á**
   ```bash
   curl -X POST http://localhost:3000/payments/intents \
     -H "Content-Type: application/json" \
     -d '{"amount": 100, "description": "Test Live Mode"}'
   ```

‚ö†Ô∏è **‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô**: Live Mode ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á! ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡πÜ (‡πÄ‡∏ä‡πà‡∏ô 1 ‡∏ö‡∏≤‡∏ó = 100 ‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå)

---

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô PromptPay ‡πÉ‡∏ô Stripe

‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏á Stripe ([PromptPay Documentation](https://docs.stripe.com/payments/promptpay)), PromptPay ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

#### ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
- **‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ **Thailand (TH)** ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- **‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ **THB** (‡∏ö‡∏≤‡∏ó‡πÑ‡∏ó‡∏¢)
- **Product Support**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á Checkout, Elements, Payment Links, Invoicing ‡πÅ‡∏•‡∏∞ Subscriptions

#### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Stripe

**‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!** PromptPay ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

```bash
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô API
curl https://api.stripe.com/v1/account \
  -u "sk_test_xxx:"

# ‡∏î‡∏π‡∏ó‡∏µ‡πà field "country" ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô "TH"
```

‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô Dashboard:
- ‡πÄ‡∏Ç‡πâ‡∏≤: https://dashboard.stripe.com/settings/account
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ **Business country** ‡πÄ‡∏õ‡πá‡∏ô **Thailand (TH)** ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‚ö†Ô∏è **‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ PromptPay ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ**

#### 2. ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô PromptPay ‡πÉ‡∏ô Dashboard

- ‡πÄ‡∏Ç‡πâ‡∏≤: https://dashboard.stripe.com/settings/payment_methods
- ‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô **Live Mode** (toggle ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)
- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ **"PromptPay"**
- ‡∏Ñ‡∏•‡∏¥‡∏Å **"Enable"** ‡∏´‡∏£‡∏∑‡∏≠ **"Turn on"**
- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

#### 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Account Capabilities

‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ [Account Capabilities](https://docs.stripe.com/connect/account-capabilities), PromptPay ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ capability `promptpay_payments`:

```bash
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö capabilities ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
curl https://api.stripe.com/v1/account/capabilities \
  -u "sk_live_xxx:"

# ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Connected Account
curl https://api.stripe.com/v1/accounts/{{ACCOUNT_ID}}/capabilities \
  -u "sk_live_xxx:"
```

‡πÉ‡∏ô response ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô:
```json
{
  "promptpay_payments": {
    "status": "active",
    "requested": true
  }
}
```

‡∏ñ‡πâ‡∏≤ status ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô "active" ‡πÉ‡∏´‡πâ request capability:
```bash
curl https://api.stripe.com/v1/accounts/{{ACCOUNT_ID}}/capabilities/promptpay_payments \
  -u "sk_live_xxx:" \
  -d requested=true
```

#### 4. ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à (Live Mode ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)

Stripe ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Live Mode:

**‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:**
- ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó / ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤
- ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏•‡∏á‡∏ô‡∏≤‡∏°
- ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
- ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ (Tax ID)

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:**
- ‡πÄ‡∏Ç‡πâ‡∏≤: https://dashboard.stripe.com/settings/account
- ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô **"Business details"** ‡∏´‡∏£‡∏∑‡∏≠ **"Verification"**
- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠
- ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (‡πÇ‡∏î‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥ 1-3 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£)

#### 5. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô

```bash
curl https://api.stripe.com/v1/account \
  -u "sk_live_xxx:"
```

‡∏î‡∏π‡∏ó‡∏µ‡πà field:
```json
{
  "charges_enabled": true,
  "payouts_enabled": true,
  "requirements": {
    "currently_due": [],  // ‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤
    "disabled_reason": null
  }
}
```

‡∏ñ‡πâ‡∏≤ `currently_due` ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°

---

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Debug ‡∏à‡∏≤‡∏Å Server Log

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÅ‡∏•‡πâ‡∏ß ‡∏î‡∏π‡∏ó‡∏µ‡πà terminal ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå ‡∏à‡∏∞‡∏°‡∏µ log ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ:

```
[PaymentsService] Creating PaymentIntent: 10000 thb
[PaymentsService] Payment Intent Status: requires_action, Next Action Type: undefined
[PaymentsService] QR Code not found. Next action type: undefined. Available properties: []
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡πà‡∏≤‡∏ô:**

- `Status: requires_action` ‚Üí ‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ action)
- `Next Action Type: undefined` ‚Üí ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• next_action
- `Available properties: []` ‚Üí ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ properties ‡∏Ç‡∏≠‡∏á QR Code

**‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤:** Stripe ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á QR Code ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ ‚Üí ‡πÉ‡∏ä‡πâ Test Mode ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°

---

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 4: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Stripe CLI

```bash
# ‡∏î‡∏π Payment Intent ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á
stripe payment_intents list --limit 1

# ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á Payment Intent
stripe payment_intents retrieve pi_xxxxxxxxxxxxx

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ next_action ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
```

‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô response ‡πÑ‡∏°‡πà‡∏°‡∏µ `next_action` ‡∏´‡∏£‡∏∑‡∏≠ `next_action` ‡πÑ‡∏°‡πà‡∏°‡∏µ QR Code data ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Live Mode

---

## üéØ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (Live Mode)

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏≤‡∏Å ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:

### 1. ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡πâ‡∏≠‡∏¢
```json
{
  "amount": 100,  // 1 ‡∏ö‡∏≤‡∏ó
  "description": "Test PromptPay Live Mode"
}
```

### 2. ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á
- ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
- ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô 1 ‡∏ö‡∏≤‡∏ó
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### 3. Refund (‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô)
```bash
# ‡∏ú‡πà‡∏≤‡∏ô Stripe Dashboard
# ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡πà‡∏≤‡∏ô API
stripe refunds create --payment-intent pi_xxxxxxxxxxxxx
```

---

## üìä ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

### ‚úÖ ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:

```json
{
  "paymentIntentId": "pi_xxxxxxxxxxxxx",
  "status": "requires_action",
  "qr": {
    "imageUrl": "https://qr.stripe.com/...png",  // ‚úÖ ‡∏°‡∏µ URL
    "data": "00020101021..."                      // ‚úÖ ‡∏°‡∏µ QR data
  },
  "error": null  // ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ error
}
```

### ‚ùå ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:

```json
{
  "paymentIntentId": "pi_xxxxxxxxxxxxx",
  "status": "requires_action",
  "qr": null,  // ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ QR
  "error": "QR Code not available..."  // ‚ùå ‡∏°‡∏µ error message
}
```

---

## üîÑ Alternative: ‡πÉ‡∏ä‡πâ Stripe Checkout (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡πÄ‡∏≠‡∏á)

‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ QR Code ‡πÄ‡∏≠‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ **Stripe Checkout** ‡πÅ‡∏ó‡∏ô:

```typescript
// ‡∏™‡∏£‡πâ‡∏≤‡∏á Checkout Session ‡πÅ‡∏ó‡∏ô Payment Intent
const session = await stripe.checkout.sessions.create({
  payment_method_types: ['promptpay'],
  line_items: [{
    price_data: {
      currency: 'thb',
      product_data: {
        name: '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
      },
      unit_amount: 10000,
    },
    quantity: 1,
  }],
  mode: 'payment',
  success_url: 'https://yourdomain.com/success',
  cancel_url: 'https://yourdomain.com/cancel',
});

// Redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Stripe (Stripe ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á QR ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á)
// session.url
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡πÄ‡∏≠‡∏á
- Stripe ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤ UI ‡πÉ‡∏´‡πâ
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á Test ‡πÅ‡∏•‡∏∞ Live Mode

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‡∏ï‡πâ‡∏≠‡∏á redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Stripe
- customize UI ‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤

---

## üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Stripe Support

‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Stripe Support:

1. ‡πÄ‡∏Ç‡πâ‡∏≤: https://support.stripe.com/
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Contact Support"
3. ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤: "PromptPay QR Code not showing in Payment Intent"
4. ‡πÅ‡∏ô‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
   - Payment Intent ID
   - Country: Thailand
   - Account ID

---

## üìö ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å Stripe

### ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å:
- **[PromptPay Payments](https://docs.stripe.com/payments/promptpay)** - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô PromptPay
- **[How to Enable PromptPay](https://support.stripe.com/questions/how-to-enable-promptpay)** - ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô PromptPay
- **[Account Capabilities](https://docs.stripe.com/connect/account-capabilities)** - ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Capabilities
- **[Payment Intent API Reference](https://docs.stripe.com/api/payment_intents)** - API Documentation
- **[Testing PromptPay](https://docs.stripe.com/testing#promptpay)** - ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡∏≤‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£:

#### ‡∏à‡∏≤‡∏Å [PromptPay Documentation](https://docs.stripe.com/payments/promptpay):
- **Customer locations**: Thailand
- **Presentment currency**: THB ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- **Payment confirmation**: Customer-initiated (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏≠‡∏á)
- **Refunds support**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ email ‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)
- **Statement descriptor**: ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô "STRIPE PAYMENTS (THAILAND) LTD" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ)

#### ‡∏à‡∏≤‡∏Å [Account Capabilities](https://docs.stripe.com/connect/account-capabilities):
- ‡∏ï‡πâ‡∏≠‡∏á request capability `promptpay_payments`
- Capability status ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô "active" ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
- Test Mode ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà enforce capabilities ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î
- Connected Accounts ‡∏ï‡πâ‡∏≠‡∏á request capabilities ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å

---

## ‚úÖ Checklist ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Stripe
- [ ] ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Stripe ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ (TH) ‚ú® **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î**
- [ ] ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (Live Mode ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
- [ ] `charges_enabled: true` ‡πÅ‡∏•‡∏∞ `payouts_enabled: true`
- [ ] `requirements.currently_due` ‡πÄ‡∏õ‡πá‡∏ô array ‡∏ß‡πà‡∏≤‡∏á `[]`

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô PromptPay
- [ ] ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô PromptPay ‡πÉ‡∏ô Dashboard ‚Üí Settings ‚Üí Payment Methods
- [ ] Request capability `promptpay_payments` (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö status = "active")
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô **Live Mode** (Test Mode ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö PromptPay ‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö)

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
- [ ] ‡πÉ‡∏ä‡πâ `sk_live_` (Live Secret Key) ‡πÅ‡∏ó‡∏ô `sk_test_` ‡πÉ‡∏ô `.env`
- [ ] ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ webhook ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Live Mode: `stripe listen --forward-to localhost:3000/payments/webhook --live`
- [ ] ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Live webhook secret ‡πÑ‡∏õ‡πÉ‡∏™‡πà `STRIPE_WEBHOOK_SECRET` ‡πÉ‡∏ô `.env`
- [ ] Restart ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç .env: `npm run start:dev`

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡πÜ (1-10 ‡∏ö‡∏≤‡∏ó)
- [ ] ‡∏î‡∏π server logs ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• debug
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ QR Code URL ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
- [ ] ‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÅ‡∏•‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á
- [ ] Refund ‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ API:
```bash
# 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô TH)
curl https://api.stripe.com/v1/account -u "sk_live_xxx:"

# 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö PromptPay capability (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô active)
curl https://api.stripe.com/v1/account/capabilities -u "sk_live_xxx:"

# 3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Payment Intent
curl -X POST https://api.stripe.com/v1/payment_intents \
  -u "sk_live_xxx:" \
  -d amount=100 \
  -d currency=thb \
  -d "payment_method_types[]"=promptpay
```

---

**‡∏™‡∏£‡∏∏‡∏õ:** ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Test Mode ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Live Mode ‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡πâ‡∏≠‡∏¢ (1 ‡∏ö‡∏≤‡∏ó) ‡πÅ‡∏•‡πâ‡∏ß refund ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ üéâ

